# Feature Specification: 인증 및 온보딩 플로우

**Feature Branch**: `001-auth-onboarding-flow`
**Created**: 2026-01-07
**Status**: Draft
**Input**: SwiftUI 앱의 Splash, Onboarding, 로그인/회원가입 화면 구현

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 스플래시 화면 및 앱 초기화 (Priority: P1)

사용자가 앱을 실행하면 브랜딩이 포함된 스플래시 화면이 표시되고, 앱 상태에 따라 적절한 화면으로 자동 이동합니다.

**Why this priority**: 앱의 첫 진입점으로, 사용자 경험의 시작이자 앱 상태 판단의 핵심 로직을 담당합니다.

**Independent Test**: 앱을 다양한 상태(최초 실행, 자동로그인 활성화, 토큰 만료 등)에서 실행하여 올바른 화면으로 이동하는지 검증할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 앱을 처음 설치한 사용자, **When** 앱을 실행하면, **Then** 스플래시 화면이 1.5~3초 표시된 후 온보딩 화면으로 이동합니다.
2. **Given** 자동로그인이 활성화되고 유효한 토큰이 있는 사용자, **When** 앱을 실행하면, **Then** 스플래시 화면이 표시된 후 메인 화면으로 직접 이동합니다.
3. **Given** 자동로그인이 비활성화되거나 토큰이 없는 기존 사용자, **When** 앱을 실행하면, **Then** 스플래시 화면이 표시된 후 로그인 화면으로 이동합니다.
4. **Given** 자동로그인 토큰이 만료된 사용자, **When** 앱을 실행하면, **Then** 스플래시 화면에서 토큰 갱신을 시도하고, 실패 시 로그인 화면으로 이동합니다.

---

### User Story 2 - 온보딩 경험 (Priority: P2)

최초 앱 사용자가 앱의 주요 기능과 가치를 슬라이드 형식으로 안내받고, 완료 시 로그인 화면으로 이동합니다.

**Why this priority**: 최초 사용자의 앱 이해와 관심 유발에 중요하지만, 기존 사용자에게는 표시되지 않습니다.

**Independent Test**: 앱 최초 실행 시 온보딩 화면이 표시되고, 스와이프 및 버튼 동작이 정상 작동하는지 검증할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 온보딩 화면에 있는 사용자, **When** 좌우로 스와이프하면, **Then** 다음/이전 페이지로 부드럽게 전환되고 페이지 인디케이터가 업데이트됩니다.
2. **Given** 온보딩의 첫 번째 또는 중간 페이지에 있는 사용자, **When** "건너뛰기" 버튼을 탭하면, **Then** 즉시 로그인 화면으로 이동합니다.
3. **Given** 온보딩의 마지막 페이지에 있는 사용자, **When** "시작하기" 버튼을 탭하면, **Then** 로그인 화면으로 이동하고 온보딩 완료 상태가 저장됩니다.
4. **Given** 온보딩을 완료한 사용자, **When** 앱을 다시 실행하면, **Then** 온보딩 화면이 다시 표시되지 않습니다.

---

### User Story 3 - 이메일/비밀번호 로그인 (Priority: P1)

기존 회원이 이메일과 비밀번호를 입력하여 앱에 로그인하고, 자동로그인 옵션을 선택할 수 있습니다.

**Why this priority**: 핵심 인증 기능으로, 앱의 보호된 기능에 접근하기 위한 필수 기능입니다.

**Independent Test**: 유효한/무효한 자격증명으로 로그인을 시도하여 성공/실패 시나리오를 검증할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 로그인 화면에서 유효한 이메일과 비밀번호를 입력한 사용자, **When** 로그인 버튼을 탭하면, **Then** 인증이 성공하고 메인 화면으로 이동합니다.
2. **Given** 잘못된 이메일 형식을 입력한 사용자, **When** 다음 필드로 이동하면, **Then** 실시간으로 이메일 형식 오류 메시지가 표시됩니다.
3. **Given** 8자 미만의 비밀번호를 입력한 사용자, **When** 로그인 버튼을 확인하면, **Then** 버튼이 비활성화 상태입니다.
4. **Given** 유효하지 않은 자격증명으로 로그인을 시도한 사용자, **When** 로그인 버튼을 탭하면, **Then** 명확한 오류 메시지가 표시됩니다.
5. **Given** 자동로그인을 활성화하고 로그인에 성공한 사용자, **When** 앱을 종료 후 다시 실행하면, **Then** 로그인 화면 없이 메인 화면으로 직접 이동합니다.
6. **Given** 비밀번호 입력 필드에 입력 중인 사용자, **When** 보기/숨기기 토글을 탭하면, **Then** 비밀번호가 평문/마스킹 상태로 전환됩니다.

---

### User Story 4 - 소셜 로그인 (카카오, 네이버, Apple) (Priority: P2)

사용자가 기존 소셜 계정(카카오, 네이버, Apple)을 사용하여 빠르게 로그인할 수 있습니다.

**Why this priority**: 사용자 편의성을 높이고 가입 장벽을 낮추지만, 이메일 로그인이 기본 대안으로 존재합니다.

**Independent Test**: 각 소셜 로그인 버튼을 탭하여 해당 OAuth 플로우가 시작되고 인증 후 앱으로 돌아오는지 검증할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 로그인 화면에서 카카오 로그인 버튼을 탭한 사용자, **When** 카카오 계정으로 인증하면, **Then** 앱으로 돌아와 메인 화면으로 이동합니다.
2. **Given** 로그인 화면에서 네이버 로그인 버튼을 탭한 사용자, **When** 네이버 계정으로 인증하면, **Then** 앱으로 돌아와 메인 화면으로 이동합니다.
3. **Given** 로그인 화면에서 Apple 로그인 버튼을 탭한 사용자, **When** Apple ID로 인증하면, **Then** 앱으로 돌아와 메인 화면으로 이동합니다.
4. **Given** 소셜 로그인 중 사용자가 인증을 취소한 경우, **When** 앱으로 돌아오면, **Then** 로그인 화면에 머무르고 취소 알림이 표시됩니다.

---

### User Story 5 - 회원가입 (Priority: P1)

새로운 사용자가 이메일, 비밀번호, 이름을 입력하고 약관에 동의하여 계정을 생성할 수 있습니다.

**Why this priority**: 신규 사용자 확보를 위한 필수 기능입니다.

**Independent Test**: 회원가입 폼을 작성하고 제출하여 계정 생성 및 자동 로그인이 되는지 검증할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 회원가입 화면에서 모든 필드를 올바르게 입력하고 약관에 동의한 사용자, **When** 회원가입 버튼을 탭하면, **Then** 계정이 생성되고 자동으로 로그인되어 메인 화면으로 이동합니다.
2. **Given** 이미 등록된 이메일을 입력한 사용자, **When** 이메일 중복 확인이 실행되면, **Then** 이메일이 이미 사용 중이라는 오류 메시지가 표시됩니다.
3. **Given** 비밀번호와 비밀번호 확인이 일치하지 않는 사용자, **When** 비밀번호 확인 필드에서 포커스가 벗어나면, **Then** 비밀번호 불일치 오류가 표시됩니다.
4. **Given** 필수 약관(이용약관, 개인정보처리방침) 중 하나라도 동의하지 않은 사용자, **When** 회원가입 버튼을 확인하면, **Then** 버튼이 비활성화 상태입니다.
5. **Given** 8자 미만의 비밀번호를 입력한 사용자, **When** 다음 필드로 이동하면, **Then** 비밀번호 길이 오류 메시지가 표시됩니다.

---

### User Story 6 - 비밀번호 찾기 (Priority: P3)

사용자가 비밀번호를 잊어버린 경우 이메일을 통해 비밀번호를 재설정할 수 있습니다.

**Why this priority**: 중요한 복구 기능이지만, 초기 MVP 이후 구현해도 됩니다.

**Independent Test**: 비밀번호 찾기 링크를 탭하고 이메일을 입력하여 재설정 안내가 발송되는지 검증할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 로그인 화면에서 "비밀번호 찾기" 링크를 탭한 사용자, **When** 등록된 이메일을 입력하고 제출하면, **Then** 비밀번호 재설정 이메일 발송 안내가 표시됩니다.
2. **Given** 등록되지 않은 이메일로 비밀번호 찾기를 시도한 사용자, **When** 제출하면, **Then** 보안을 위해 동일한 성공 메시지가 표시됩니다(정보 유출 방지).

---

### Edge Cases

- 네트워크 연결이 없는 상태에서 로그인/회원가입 시도 시 적절한 오류 메시지 표시
- 스플래시 화면에서 토큰 갱신 중 네트워크 오류 발생 시 로그인 화면으로 이동
- 소셜 로그인 제공업체 서버 장애 시 대체 로그인 방법 안내
- 입력 중 앱이 백그라운드로 이동했다가 복귀 시 입력 상태 유지
- 키보드가 입력 필드를 가리는 경우 자동 스크롤 처리
- 토큰 만료 시간이 임박한 상태에서 API 호출 시 자동 갱신 후 재시도
- 동시에 여러 기기에서 로그인 시 기존 세션 처리 정책 적용
- 회원가입 중 앱 종료 시 입력 데이터 보존 여부 (보존하지 않음 - 보안)

## Requirements *(mandatory)*

### Functional Requirements

#### 스플래시 화면

- **FR-001**: 시스템은 앱 시작 시 로고와 브랜딩이 포함된 스플래시 화면을 표시해야 합니다.
- **FR-002**: 스플래시 화면은 최소 1.5초, 최대 3초 동안 표시되어야 합니다.
- **FR-003**: 시스템은 스플래시 화면에서 앱 상태(최초 실행, 자동로그인, 토큰 유효성)를 확인하고 적절한 화면으로 이동해야 합니다.

#### 온보딩 화면

- **FR-004**: 시스템은 최초 실행 사용자에게 3~4개의 슬라이드로 구성된 온보딩 화면을 표시해야 합니다.
- **FR-005**: 각 온보딩 페이지는 이미지, 제목, 설명, 페이지 인디케이터를 포함해야 합니다.
- **FR-006**: 사용자는 좌우 스와이프로 온보딩 페이지를 탐색할 수 있어야 합니다.
- **FR-007**: 시스템은 "건너뛰기" 버튼을 제공하여 온보딩을 즉시 종료할 수 있어야 합니다.
- **FR-008**: 마지막 온보딩 페이지에서 "시작하기" 버튼을 표시해야 합니다.
- **FR-009**: 시스템은 온보딩 완료 상태를 저장하여 재실행 시 다시 표시하지 않아야 합니다.

#### 로그인 화면

- **FR-010**: 시스템은 이메일과 비밀번호 입력 필드를 제공해야 합니다.
- **FR-011**: 시스템은 이메일 형식을 실시간으로 검증하고 오류 시 피드백을 제공해야 합니다.
- **FR-012**: 비밀번호 필드는 SecureField로 마스킹되어야 하고, 보기/숨기기 토글을 제공해야 합니다.
- **FR-013**: 비밀번호는 최소 8자 이상이어야 하며, 미충족 시 로그인 버튼이 비활성화되어야 합니다.
- **FR-014**: 시스템은 자동로그인 토글 스위치를 제공해야 합니다.
- **FR-015**: 로그인 버튼은 모든 유효성 검사가 통과된 경우에만 활성화되어야 합니다.
- **FR-016**: 시스템은 "비밀번호 찾기" 링크를 제공해야 합니다.
- **FR-017**: 로그인 성공 시 인증 토큰을 안전하게 저장하고 메인 화면으로 이동해야 합니다.

#### 소셜 로그인

- **FR-018**: 시스템은 카카오, 네이버, Apple 로그인 버튼을 수평으로 배치해야 합니다.
- **FR-019**: 카카오 로그인 버튼은 노란색(#FEE500)으로 표시되어야 합니다.
- **FR-020**: 네이버 로그인 버튼은 녹색(#03C75A)으로 표시되어야 합니다.
- **FR-021**: Apple 로그인 버튼은 검정색으로 표시되고 Apple 가이드라인을 준수해야 합니다.
- **FR-022**: 각 소셜 로그인은 해당 OAuth 플로우를 시작하고 인증 후 앱으로 복귀해야 합니다.

#### 회원가입 화면

- **FR-023**: 시스템은 이메일, 비밀번호, 비밀번호 확인, 이름 입력 필드를 제공해야 합니다.
- **FR-024**: 이메일 입력 시 실시간으로 중복 확인을 수행하고 결과를 표시해야 합니다.
- **FR-025**: 비밀번호는 최소 8자 이상이어야 합니다.
- **FR-026**: 비밀번호와 비밀번호 확인 필드의 일치 여부를 실시간 검증해야 합니다.
- **FR-027**: 시스템은 이용약관 동의 체크박스를 제공하고, 약관 내용을 볼 수 있어야 합니다.
- **FR-028**: 시스템은 개인정보처리방침 동의 체크박스를 제공하고, 방침 내용을 볼 수 있어야 합니다.
- **FR-029**: 모든 필수 입력과 동의가 완료된 경우에만 회원가입 버튼이 활성화되어야 합니다.
- **FR-030**: 회원가입 성공 시 자동으로 로그인되고 메인 화면으로 이동해야 합니다.

#### 인증 및 보안

- **FR-031**: 인증 토큰(Access Token, Refresh Token)은 Keychain에 안전하게 저장되어야 합니다.
- **FR-032**: Access Token 만료 시 Refresh Token을 사용하여 자동 갱신해야 합니다.
- **FR-033**: 로그아웃 시 Keychain의 모든 인증 정보를 완전히 삭제해야 합니다.
- **FR-034**: 모든 네트워크 통신은 HTTPS를 통해 이루어져야 합니다.
- **FR-035**: 비밀번호, 토큰 등 민감 정보는 로그에 출력되지 않아야 합니다.

#### 에러 처리

- **FR-036**: 시스템은 모든 API 에러에 대해 사용자 친화적인 메시지를 표시해야 합니다.
- **FR-037**: 네트워크 오류 시 재시도 옵션을 제공해야 합니다.
- **FR-038**: 요청 제한 초과(429) 시 적절한 대기 안내를 표시해야 합니다.

#### UI/UX

- **FR-039**: 모든 화면은 다크모드를 지원해야 합니다.
- **FR-040**: API 호출 중 로딩 상태를 시각적으로 표시해야 합니다.
- **FR-041**: 키보드가 입력 필드를 가릴 경우 자동으로 스크롤해야 합니다.
- **FR-042**: 화면의 다른 영역 탭 시 키보드가 닫혀야 합니다.
- **FR-043**: 모든 인터랙티브 요소에 접근성 레이블을 제공해야 합니다.

### Key Entities

- **User**: 사용자 정보를 나타내며, ID, 이메일, 이름, 인증 제공자(provider) 속성을 포함합니다.
- **AuthToken**: 인증 토큰 정보를 나타내며, Access Token과 Refresh Token을 포함합니다.
- **OnboardingPage**: 온보딩 페이지 정보를 나타내며, 이미지, 제목, 설명 속성을 포함합니다.

### Assumptions

- 서버 API가 명세된 엔드포인트와 요청/응답 형식을 지원합니다.
- 카카오, 네이버, Apple OAuth SDK가 프로젝트에 통합되어 있습니다.
- iOS 15 이상을 타겟으로 합니다.
- 온보딩 페이지는 3개로 구성됩니다 (앱 소개, 주요 기능, 시작하기).
- 이메일 중복 확인은 입력 후 0.5초 디바운스 적용됩니다.
- 비밀번호 재설정 이메일 발송 API는 별도로 구현됩니다.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자가 회원가입을 2분 이내에 완료할 수 있습니다.
- **SC-002**: 사용자가 로그인을 30초 이내에 완료할 수 있습니다.
- **SC-003**: 스플래시 화면에서 다음 화면으로의 전환이 3초 이내에 이루어집니다.
- **SC-004**: 온보딩 완료율이 80% 이상입니다 (건너뛰기 포함).
- **SC-005**: 자동로그인 활성화 시 앱 재실행에서 메인 화면까지 5초 이내에 도달합니다.
- **SC-006**: 모든 폼 유효성 검사 피드백이 0.3초 이내에 표시됩니다.
- **SC-007**: 소셜 로그인 성공률이 95% 이상입니다 (제공업체 장애 제외).
- **SC-008**: 에러 메시지가 100% 사용자 친화적 언어로 표시됩니다 (기술적 용어 없음).
- **SC-009**: 모든 화면이 VoiceOver로 100% 탐색 가능합니다.
- **SC-010**: 다크모드와 라이트모드 전환 시 100% UI 요소가 적절히 표시됩니다.
